const DMProvider=class extends AbstractProvider{search(){let t=this.getIdFromLocation();t&&!this.ids[t]&&this.addVideo(t,".dmp_Player.np_Player")}getIdFromLocation(){return/^\/\w{0,2}$/.test(location.pathname)?null:location.pathname.replace("/video/","")}validationId(t){return/[\w\d]{1,9}/i.test(t)}parseMpegString(t){return t.split("\n").slice(1,-1).reduce((t,e,a,r)=>0==a%2?[...t,{props:e,stream:r[a+1]}]:t,[])}mapKeys(t,e){return{formatId:e,formatName:"mp4",formatNote:`${t.NAME}p`,formatWidth:+t.NAME,formatType:"video",formatCodec:t.CODECS,url:t["PROGRESSIVE-URI"]}}parseMPEGData(t,e){let{props:a}=t,r=a.match(/[A-Z\-_]+=/g);if(r){let i=r.map(t=>t.replace("=","")).reduce((t,e,r,i)=>{let o=i[r+1],s=this.betweenStr(a,`${e}=`,o?`,${o}`:void 0).replace(/\"/g,"");return s?{...t,[e]:s}:t},{});return this.mapKeys(i,e)}}getFormats(t={}){return new Promise(e=>{let{qualities:a={}}=t,{auto:r}=a;r&&0!==r.length||e([]);let i=r[0];fetch(i.url).then(t=>t.text()).then(t=>{t||e([]);let a=this.parseMpegString(t).map((t,e)=>this.parseMPEGData(t,e));e(this.sortFormatsByWidth(this.filterUnique(a)))})})}getVideoData(t,e){if(!this.validationId(t))throw Error("No valid id");let a=new URL("https://www.dailymotion.com/player/metadata/video/");a.pathname+=t,a.searchParams.append("app","com.dailymotion.neon"),a.searchParams.append("locale","en"),a.searchParams.append("client_type","website"),fetch(a.href).then(t=>t.text()).then(t=>{if(!t)throw Error("There are no metadata!");return JSON.parse(t)}).then(t=>Promise.all([{id:t.view_id,title:t.title},this.getFormats(t)])).then(t=>{let a=t[1],r=[];for(let i=0;i<a.length;i++)r.push({quality:a[i].formatNote.split("@")[0].match(/\d+/)[0],url:a[i].url});r.sort((t,e)=>+t.quality<+e.quality?1:-1);let o={vid:t[0].id,title:t[0].title,provider:"dm",variants:r};e(o)}).catch(t=>{})}filterUnique(t){return t.reduce((t,e)=>-1===t.findIndex(t=>t.formatNote===e.formatNote)?[...t,e]:t,[])}sortFormatsByWidth(t){return t.sort((t,e)=>e.formatWidth>=t.formatWidth?1:-1)}};