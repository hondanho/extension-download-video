const VKProvider=class extends AbstractProvider{search(){$("video").not("."+INIT_CLASS).each((t,a)=>{let e=this.getVideoIdByHtml(a),i=a.closest(".wall_post_cont");e&&!this.ids[e]&&this.addVideo(e,i),a.classList.add(INIT_CLASS)})}getVideoIdByHtml(t){let a=!1,e=t.closest(".video_box_wrap");if(e){let i=e.id.match(/([0-9-]+_[0-9-]+)/i);if(i&&i.length>0)a={id:i[0],hash:!1};else if((i=document.location.href.match(/video([0-9-]+_[0-9-]+)/i))&&i.length>1){let l=document.location.href.match(/%2F([0-9a-zA-Z-]+)/i).length>1&&document.location.href.match(/%2F([0-9a-zA-Z-]+)/i)[1];a={id:i[1],hash:l}}if(!1===a.hash){let o=document.body.innerHTML.match(RegExp(`Video.show\\(event, '${a.id}', {autoplay: 1, queue: 1, listId: '([0-9a-z]+)'`,"i"));o&&o.length>1?a.hash=o[1]:(o=document.body.innerHTML.match(RegExp(`video${a.id}\\\\/([0-9a-z]+)`,"i")))&&o.length>1?a.hash=o[1]:(o=document.body.innerHTML.match(RegExp(`video${a.id}\\?list=([0-9a-z]+)`,"i")))&&o.length>1?a.hash=o[1]:(o=document.location.href.match(/video[0-9-_]+%2F([0-9a-zA-Z-]+)/i))&&o.length>1&&(a.hash=o[1])}return a}}getVideoData(t,a){if(!t.id||!t.hash)return;let e={act:"show",al:"1",al_ad:"0",autoplay:"1",force_no_repeat:"1",list:t.hash,module:"profile_own_videos",playlist_id:`${t.id.split("_")[0]}_1`,show_next:"1",video:t.id},i=[];for(let l in e){let o=encodeURIComponent(l),h=encodeURIComponent(e[l]);i.push(o+"="+h)}fetch("https://vk.com/al_video.php?act=show",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:i=i.join("&")}).then(t=>{let a=t.body.pipeThrough(new TextDecoderStream("windows-1251")).pipeThrough(new TextEncoderStream("utf-8"));return new Response(a)}).then(t=>t.json()).then(e=>{if(e&&e.payload&&e.payload[1]&&e.payload[1][4]&&e.payload[1][4].player&&e.payload[1][4].player.params[0]){let i=e.payload[1][4].player.params[0],l=[];i.url240?l.push({quality:"240p",url:i.url240,duration:i.duration}):i.cache240&&l.push({quality:"240p",url:i.cache240,duration:i.duration}),i.url360?l.push({quality:"360p",url:i.url360,duration:i.duration}):i.cache360&&l.push({quality:"360p",url:i.cache360,duration:i.duration}),i.url480?l.push({quality:"480p",url:i.url480,duration:i.duration}):i.cache480&&l.push({quality:"480p",url:i.cache480,duration:i.duration}),i.url720?l.push({quality:"720p",url:i.url720,duration:i.duration}):i.cache720&&l.push({quality:"720p",url:i.cache720,duration:i.duration}),i.url1080?l.push({quality:"1080p",url:i.url1080,duration:i.duration}):i.cache1080&&l.push({quality:"1080p",url:i.cache1080,duration:i.duration});let o=0!=i.md_title.length?i.md_title:"unknown";a({vid:t.id,title:o,provider:"vk",variants:l})}else throw Error("json is unknown")}).catch(t=>{console.log(`error =  ${t}`)})}};