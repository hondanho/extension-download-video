const ServiceWorkerProvider=function(){var a;let e={keys_by_type:{}},t={},r=!0;function n(a){let e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789~!@#$%^&*()_+=-";for(var r=0;r<a;r++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}let c=n(8);function i(a){return new Promise((t,r)=>{if(a.sandbox_id=c,a.no_callback||a.hasOwnProperty("callback_id"))t(window.top.postMessage(a,"*"));else{let i=n(16);if(e.hasOwnProperty(i))return!1;e[i]={callback:t,parameters:{},sandbox_id:c},a.callback_id=i,window.top.postMessage(a,"*")}})}async function s(a,e){await i({type:"chrome_api",callback_type:"callback",no_callback:!0,api_chain:["storage","local","set"],params:[{[a]:e}]})}async function o(a,e){let t=await i({type:"chrome_api",callback_type:"callback",api_chain:["storage","local","get"],params:[a]});return t&&t[a]?t[a]:e}function l(a){return t[a]}async function p(a,e){t[a]=e,await s("sb_parameters",t)}async function y(){await i({type:"init_message"}),t=await o("sb_parameters",{}),e.keys_by_type=await o("sb_callbacks",{})}function b(a){return r?a:function(){}}function k(a){return r?a:async function(){}}return a=function(a){"destruct"===a&&(r=!1);let t=a.data;t.callback_id&&e.hasOwnProperty(t.callback_id)&&t.hasOwnProperty("callback_params")&&e[t.callback_id].callback(...t.callback_params)},window.addEventListener("message",a),{sendMessage:k(i),addCallback:b(function a(t,r,i){let o=!1,l=n(16);return!e.hasOwnProperty(l)&&(e.keys_by_type.hasOwnProperty(r)&&(o=!0,l=e.keys_by_type[r]),e[l]={callback:t,parameters:{...i},sandbox_id:c},e.keys_by_type[r]=l,s("sb_callbacks",e.keys_by_type),!o&&l)}),getParam:b(l),setParam:k(p),Storage:{get:k(o),set:k(s)},init:k(y)}}();async function main(){await ServiceWorkerProvider.init();let a=ServiceWorkerProvider.getParam("version");if(!a){let e=await ServiceWorkerProvider.sendMessage({type:"chrome_api",api_chain:["runtime","getManifest"]});e&&await ServiceWorkerProvider.setParam("version",a=e.version)}}location.ancestorOrigins.length&&!/^chrome-extension/.test(location.ancestorOrigins[0])&&main();